<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1DB954">
    <meta name="description" content="Contr√¥lez votre Spotify depuis Telegram">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <title>SpotiSeb Bot</title>
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header-content">
            <h1 class="app-title">
                <span class="logo">üéµ</span>
                SpotiSeb
            </h1>
            <div class="user-info" id="userInfo">
                <span class="user-name"></span>
            </div>
        </div>
    </header>

    <!-- MAIN CONTAINER -->
    <main class="container">
        <!-- NOW PLAYING SECTION -->
        <section class="now-playing-section">
            <h2 class="section-title">
                <span class="icon">‚ñ∂Ô∏è</span>
                En cours de lecture
            </h2>
            <div id="nowPlaying" class="now-playing">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Chargement...</p>
                </div>
            </div>
        </section>

        <!-- TABS NAVIGATION -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('search')">
                <span class="tab-icon">üîç</span>
                <span class="tab-label">Recherche</span>
            </button>
            <button class="tab-btn" onclick="switchTab('playlist')">
                <span class="tab-icon">üìã</span>
                <span class="tab-label">Playlist</span>
            </button>
        </div>

        <!-- TAB CONTENT: SEARCH -->
        <div id="search-tab" class="tab-content active">
            <section class="search-section">
                <h2 class="section-title">
                    <span class="icon">üîç</span>
                    Rechercher un titre
                </h2>
                
                <div class="search-container">
                    <input 
                        type="text" 
                        id="searchInput" 
                        class="search-input" 
                        placeholder="Artiste, titre, album..."
                        autocomplete="off"
                    >
                    <button id="searchBtn" class="search-btn">
                        <span class="search-icon">üîç</span>
                    </button>
                </div>
            </section>

            <section class="results-section">
                <div id="trackList" class="track-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">üéµ</div>
                        <p>Recherchez un titre pour commencer</p>
                        <p class="empty-state-hint">Essayez "Daft Punk" ou "The Weeknd"</p>
                    </div>
                </div>
            </section>
        </div>

        <!-- TAB CONTENT: PLAYLIST -->
        <div id="playlist-tab" class="tab-content">
            <section class="playlist-section">
                <h2 class="section-title">
                    <span class="icon">üìã</span>
                    Ma Playlist
                </h2>
                <div id="playlistContainer" class="playlist-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Chargement de la playlist...</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="footer-content">
            <p class="footer-text">
                Propuls√© par 
                <a href="https://spotify.com" target="_blank" rel="noopener" class="footer-link">Spotify</a>
            </p>
            <p class="footer-version">v1.0.0</p>
        </div>
    </footer>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="toast"></div>

    <!-- PWA INSTALL BUTTON -->
    <button id="installButton" class="install-btn" hidden>
        üì≤ Ajouter √† l'√©cran d'accueil
    </button>

    <!-- iOS INSTALL HINT -->
    <div id="iosInstallHint" class="install-hint" hidden>
        ‚ûï Pour ajouter <strong>SpotiSeb</strong> √† l'√©cran d'accueil :
        <br>1. Appuie sur le bouton <strong>Partager</strong> de Safari
        <br>2. Choisis <strong>"Sur l'√©cran d'accueil"</strong>
    </div>

    <!-- Script principal -->
    <script src="script.js"></script>
    
    <!-- Service Worker (PWA) -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('‚úÖ Service Worker enregistr√©:', reg.scope))
                    .catch(err => console.error('‚ùå Erreur Service Worker:', err));
            });
        }

        // PWA Install Button
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        const iosHint = document.getElementById('iosInstallHint');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.hidden = false;
        });

        installButton?.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('‚úÖ PWA install√©e');
            }
            
            deferredPrompt = null;
            installButton.hidden = true;
        });

        // D√©tection iOS pour afficher l'hint
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isInStandaloneMode = ('standalone' in window.navigator) && (window.navigator.standalone);
        
        if (isIOS && !isInStandaloneMode && iosHint) {
            iosHint.hidden = false;
            setTimeout(() => {
                iosHint.style.opacity = '0';
                setTimeout(() => iosHint.hidden = true, 300);
            }, 8000);
        }

        // User Info
        try {
            const tg = window.Telegram?.WebApp;
            if (tg?.initDataUnsafe?.user) {
                const userName = document.querySelector('.user-name');
                if (userName) {
                    userName.textContent = tg.initDataUnsafe.user.first_name || 'Utilisateur';
                }
            }
        } catch (error) {
            console.error('Erreur chargement user info:', error);
        }
    </script>
</body>
</html>
