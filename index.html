<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1DB954">
    <meta name="description" content="ContrÃ´lez votre Spotify depuis Telegram">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <title>Spotify Bot</title>
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <svg class="spotify-logo" viewBox="0 0 496 512" fill="#1DB954">
            <path d="M248 8C111.1 8 0 119.1 0 256s111.1 248 248 248 248-111.1 248-248S384.9 8 248 8zm100.7 364.9c-4.2 0-6.8-1.3-10.7-3.6-62.4-37.6-135-39.2-206.7-24.5-3.9 1-9 2.6-11.9 2.6-9.7 0-15.8-7.7-15.8-15.8 0-10.3 6.1-15.2 13.6-16.8 81.9-18.1 165.6-16.5 237 26.2 6.1 3.9 9.7 7.4 9.7 16.5s-7.1 15.4-15.2 15.4zm26.9-65.6c-5.2 0-8.7-2.3-12.3-4.2-62.5-37-155.7-51.9-238.6-29.4-4.8 1.3-7.4 2.6-11.9 2.6-10.7 0-19.4-8.7-19.4-19.4s5.2-17.8 15.5-20.7c27.8-7.8 56.2-13.6 97.8-13.6 64.9 0 127.6 16.1 177 45.5 8.1 4.8 11.3 11 11.3 19.7-.1 10.8-8.5 19.5-19.4 19.5zm31-76.2c-5.2 0-8.4-1.3-12.9-3.9-71.2-42.5-198.5-52.7-280.9-29.7-3.6 1-8.1 2.6-12.9 2.6-13.2 0-23.3-10.3-23.3-23.6 0-13.6 8.4-21.3 17.4-23.9 35.2-10.3 74.6-15.2 117.5-15.2 73 0 149.5 15.2 205.4 47.8 7.8 4.5 12.9 10.7 12.9 22.6 0 13.6-11 23.3-23.2 23.3z"/>
        </svg>
        <h1>Spotify</h1>
        <p>Recherchez et ajoutez des musiques</p>
    </div>

    <!-- NOW PLAYING -->
    <div class="now-playing-card" id="nowPlayingCard" onclick="loadNowPlaying()">
        <div class="now-playing-header">
            <div class="pulse-dot"></div>
            <span>En Ã©coute</span>
        </div>
        <div id="nowPlayingContent">
            <div class="now-playing-empty">
                Cliquez pour voir la musique en cours
            </div>
        </div>
    </div>

    <!-- SEARCH BAR -->
    <div class="search-container">
        <span class="search-icon">ğŸ”</span>
        <input type="text" class="search-box" id="searchInput" placeholder="Artistes, titres ou podcasts">
    </div>

    <!-- QUICK ACTIONS -->
    <div class="quick-actions">
        <button class="quick-btn" onclick="togglePlaylist()">
            ğŸ“‹ Voir Otera
        </button>
        <button class="quick-btn btn-follow" onclick="followPlaylist()">
            â• Suivre
        </button>
    </div>

    <!-- PLAYLIST SECTION -->
    <div class="playlist-section" id="playlistSection">
        <div class="playlist-header">
            <div class="playlist-info">
                <div class="playlist-cover">ğŸµ</div>
                <div class="playlist-details">
                    <h3>Playlist Otera</h3>
                    <p id="playlistCount">Chargement...</p>
                </div>
            </div>
        </div>
        <div id="playlistTracks"></div>
    </div>

    <!-- SEARCH RESULTS -->
    <div class="results" id="results">
        <div class="section-title">ğŸ’¿ RÃ©sultats</div>
        <div id="trackList"></div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div class="toast" id="toast"></div>

    <!-- PWA INSTALL BUTTON -->
    <button id="installButton" class="install-btn" hidden>
        ğŸ“² Installer l'application
    </button>

    <!-- iOS INSTALL HINT -->
    <div id="iosInstallHint" class="install-hint" hidden>
        â• Pour installer <strong>SpotiSeb</strong> :<br>
        1. Appuyez sur <strong>Partager</strong> dans Safari<br>
        2. SÃ©lectionnez <strong>"Sur l'Ã©cran d'accueil"</strong>
    </div>

    <!-- SCRIPTS -->
    <script src="script.js"></script>
    <script>
        // ============================================
        // PWA INSTALLATION HANDLER
        // ============================================
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        const iosHint = document.getElementById('iosInstallHint');

        // Detect iOS
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches;

        // Show iOS hint if needed
        if (isIOS && !isStandalone) {
            iosHint.hidden = false;
            setTimeout(() => {
                iosHint.style.display = 'none';
            }, 10000); // Hide after 10s
        }

        // Handle PWA install prompt (Android/Desktop)
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.hidden = false;
        });

        installButton.addEventListener('click', async () => {
            if (!deferredPrompt) return;

            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;

            if (outcome === 'accepted') {
                showToast('âœ… Application installÃ©e !');
            }

            deferredPrompt = null;
            installButton.hidden = true;
        });

        // Hide button after installation
        window.addEventListener('appinstalled', () => {
            installButton.hidden = true;
            showToast('âœ… SpotiSeb est installÃ©e !');
        });

        // ============================================
        // SERVICE WORKER REGISTRATION
        // ============================================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('âœ… Service Worker enregistrÃ©:', reg.scope))
                    .catch(err => console.error('âŒ Erreur Service Worker:', err));
            });
        }
    </script>
</body>
</html>
